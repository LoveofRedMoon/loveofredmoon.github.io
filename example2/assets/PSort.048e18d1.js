var e=Object.assign;import{d as a,f as t,a2 as l,n as o,E as r,s as n,z as s,p as i,o as u,b as d,F as v,i as m,j as p}from"./index.44837868.js";var c=a({name:"PSort",inheritAttrs:!1,props:{modelValue:{type:Array,typeStr:"T[]",mark:"渲染需要排序的数组数据, 确保传入时为初始化顺序",required:!0},childClass:{type:[Object,Function],typeStr:"object | (index: number) => object",mark:"由于结构复杂, 该参数将传递给渲染上层div的class属性, 需要传递对象或函数",default:{}},childStyle:{type:[Object,Function],typeStr:"object | (index: number) => object",mark:"由于结构复杂, 该参数将传递给渲染上层div的style属性, 需要传递对象或函数",default:{}},innerSwap:{type:Boolean,typeStr:"boolean",mark:"是否内部处理调换之后顺序数组, 将触发update:modelValue",default:!0}},emits:["swap","update:modelValue"],emitsMark:[{key:"update:modelValue",when:"顺序调整后, 一般是鼠标抬起时, 仅innerSwap开启时触发",param:"any[]",paramRemark:"调整过顺序后的数组, 为新数组"},{key:"swap",when:"顺序调整后, 一般是鼠标抬起时",param:"number[]",paramRemark:"新位置所对应的原数组中位置, 例如[1, 2, 0]表示原来1号位调换到0号位了, 2号位调换到1号位了, 0号位调换到2号位了"}],slotsMark:[{key:"default",default:"无",param:"{ data: any, index: number}",paramRemark:"data为原数据, index为渲染序号",remark:"将渲染在div内部, 在拖动时会记录元素高度, 避免拖动时调整元素高度"}],setup(e,a){const u=t(-1),{value:d}=l(),{value:v}=o(),m=t([]);r((()=>e.modelValue),(e=>{m.value=e.map(((e,a)=>s({raw:e,relativeIdx:a,height:0,moveTop:0})))}),{deep:!0,immediate:!0});const p=i((()=>{m.value.forEach(((e,a)=>{var t,l;e.height=null!=(l=null==(t=d.value[a])?void 0:t.offsetHeight)?l:0}))}),16),c=(e,a)=>{const t=m.value,l=t.length;if(t[e].relativeIdx!==a)if(a<e){const o=t[e];for(let e=0;e<a;e++)t[e].relativeIdx=e,t[e].moveTop=0;let r=0;for(let l=a;l<e;l++)t[l].relativeIdx=l+1,t[l].moveTop=o.height,r+=t[l].height;for(let a=e+1;a<l;a++)t[a].relativeIdx=a,t[a].moveTop=0;o.relativeIdx=a,o.moveTop=-r}else if(a>e+1){const o=t[e];for(let a=0;a<e;a++)t[a].relativeIdx=a,t[a].moveTop=0;let r=0;for(let l=e+1;l<a;l++)t[l].relativeIdx=l-1,t[l].moveTop=-o.height,r+=t[l].height;for(let e=a;e<l;e++)t[e].relativeIdx=e,t[e].moveTop=0;o.relativeIdx=a-1,o.moveTop=r}else for(let o=0;o<l;o++)t[o].relativeIdx=o,t[o].moveTop=0},f=i((e=>{if(!v.value||u.value<0)return;let a=e.clientY-v.value.getBoundingClientRect().top;for(let t=0,l=m.value.length;t<l;t++){const e=m.value[t];if(a-=e.height,a<=0)return a+=e.height/2,c(u.value,a<=0?t:t+1)}return c(u.value,m.value.length)}),16),h=e=>{u.value<0||(e.preventDefault(),f(e))},x=t=>{if(!m.value.every(((e,a)=>e.relativeIdx===a))){const t=m.value.map(((e,a)=>a));m.value.forEach(((e,a)=>t[e.relativeIdx]=a)),e.innerSwap&&a.emit("update:modelValue",t.map((e=>m.value[e].raw))),a.emit("swap",t),m.value.forEach(((e,a)=>e.relativeIdx=a))}u.value=-1};return document.addEventListener("mouseup",x,!1),document.addEventListener("mousemove",h,!1),n((()=>{document.removeEventListener("mouseup",x,!1),document.removeEventListener("mousemove",h,!1)})),{values:m,moveIdx:u,slots:d,sortRef:v,handleMouseDown:(e,a)=>{u.value=a,p()}}}});c.render=function(a,t,l,o,r,n){return u(),d("div",{class:["p-sort",{raise:a.moveIdx>-1}],ref:"sortRef"},[(u(!0),d(v,null,m(a.values,((t,l)=>(u(),d("div",{key:t,onMousedown:e=>a.handleMouseDown(e,l),class:["p-sort-item",e({"raise-up":a.moveIdx===l},"function"==typeof a.childClass?a.childClass(l):a.childClass)],style:e(e({},"function"==typeof a.childStyle?a.childStyle(l):a.childStyle),{top:a.moveIdx>-1?t.moveTop+"px":"0"}),ref:e=>e&&(a.slots[l]=e)},[p(a.$slots,"default",{data:t.raw,index:l})],46,["onMousedown"])))),128))],2)};export{c as _};
